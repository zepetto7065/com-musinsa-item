<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>응답 List</title>
    <style>
        table {
            border-collapse: collapse;
            width: 60%;
            margin: 20px auto;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px 12px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        caption {
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        tfoot td {
            font-weight: bold;
        }
    </style>
</head>
<body>

<div style="text-align: center;">
    <button id="minPriceBtn">구현1</button>
    <button id="singleBrandSearchBtn">구현2</button>
    <button id="priceSummaryBtn">구현3</button>
</div>

<table id="itemTable">
    <caption>ITEM LIST</caption>
    <thead>
    <tr>
        <th>카테고리</th>
        <th>브랜드</th>
        <th>가격</th>
    </tr>
    </thead>
    <tbody></tbody>
    <tfoot>
    <tr>
        <td colspan="2">총액</td>
        <td id="totalPrice">0</td>
    </tr>
    </tfoot>
</table>

<script>
    function loadMinPriceData() {
        fetch('/api/item-summary/min-price')
            .then(response => {
                if (!response.ok) {
                    return response.json().then(err => {
                        throw new Error(err.message || '요청 실패');
                    });
                }
                return response.json();
            })
            .then(data => {
                const tbody = document.querySelector('#itemTable tbody');
                const totalTd = document.getElementById('totalPrice');
                tbody.innerHTML = '';
                totalTd.textContent = '0';

                const items = data.detailList;

                const caption = document.querySelector('#itemTable caption');
                caption.textContent = `카테고리 . 최저가격 브랜드와 상품가격, 총액을 조회`;

                items.forEach(item => {
                    const tr = document.createElement('tr');

                    const categoryTd = document.createElement('td');
                    categoryTd.textContent = item.categoryName;

                    const brandTd = document.createElement('td');
                    brandTd.textContent = item.brandName;

                    const priceTd = document.createElement('td');
                    priceTd.textContent = Number(item.price).toLocaleString();

                    tr.appendChild(categoryTd);
                    tr.appendChild(brandTd);
                    tr.appendChild(priceTd);

                    tbody.appendChild(tr);
                });

                totalTd.textContent = Number(data.totalPrice).toLocaleString();
            })
            .catch(err => {
                alert("데이터 조회 실패 : " +  err.message);
            });
    }

    function loadSingleBrandSearchData() {
        fetch('/api/item-summary/single-brand')
            .then(response => {
                if (!response.ok) {
                    return response.json().then(err => {
                        throw new Error(err.message || '요청 실패');
                    });
                }
                return response.json();
            })
            .then(data => {
                const tbody = document.querySelector('#itemTable tbody');
                const totalTd = document.getElementById('totalPrice');
                tbody.innerHTML = '';
                totalTd.textContent = '0';

                const caption = document.querySelector('#itemTable caption');
                caption.textContent = `단일 브랜드로 모든 카테고리의 상품을 구매시, 최저가격에 판매하는 브랜드와 카테고리의 상품가격 , 총액을 조회`;

                const brandName = data.brandName;
                const items = data.details;
                const totalPrice = data.totalPrice;

                items.forEach(item => {
                    const tr = document.createElement('tr');

                    const categoryTd = document.createElement('td');
                    categoryTd.textContent = item.categoryName;

                    const brandTd = document.createElement('td');
                    brandTd.textContent = brandName;

                    const priceTd = document.createElement('td');
                    priceTd.textContent = item.minPrice;

                    tr.appendChild(categoryTd);
                    tr.appendChild(brandTd);
                    tr.appendChild(priceTd);

                    tbody.appendChild(tr);
                });

                totalTd.textContent = totalPrice;
            })
            .catch(err => {
                alert("데이터 조회 실패 : " +  err.message);
            });
    }

    function loadPriceSummaryData() {
        const categoryName = prompt("카테고리 이름을 입력하세요:");
        if (!categoryName) return;

        fetch(`/api/item-summary/price?categoryName=${encodeURIComponent(categoryName)}`)
            .then(response => {
                if (!response.ok) {
                    return response.json().then(err => {
                        throw new Error(err.message || '요청 실패');
                    });
                }
                return response.json();
            })
            .then(data => {
                const tbody = document.querySelector('#itemTable tbody');
                const totalTd = document.getElementById('totalPrice');
                tbody.innerHTML = '';
                totalTd.textContent = '-';

                const caption = document.querySelector('#itemTable caption');
                caption.textContent = `카테고리 "${data.categoryName}"의 최저가/최고가 브랜드 정보`;

                const minItems = data.minItem || [];
                const maxItems = data.maxItem || [];

                minItems.forEach(item => {
                    const tr = document.createElement('tr');
                    const categoryTd = document.createElement('td');
                    categoryTd.textContent = "최저가";

                    const brandTd = document.createElement('td');
                    brandTd.textContent = item.brandName;

                    const priceTd = document.createElement('td');
                    priceTd.textContent = Number(item.price).toLocaleString();

                    tr.appendChild(categoryTd);
                    tr.appendChild(brandTd);
                    tr.appendChild(priceTd);

                    tbody.appendChild(tr);
                });

                maxItems.forEach(item => {
                    const tr = document.createElement('tr');
                    const categoryTd = document.createElement('td');
                    categoryTd.textContent = "최고가";

                    const brandTd = document.createElement('td');
                    brandTd.textContent = item.brandName;

                    const priceTd = document.createElement('td');
                    priceTd.textContent = Number(item.price).toLocaleString();

                    tr.appendChild(categoryTd);
                    tr.appendChild(brandTd);
                    tr.appendChild(priceTd);

                    tbody.appendChild(tr);
                });
            })
            .catch(err => {
                alert("카테고리 가격 요약 데이터 조회 실패 : " +  err.message);
            });
    }


    document.getElementById('minPriceBtn').addEventListener('click', loadMinPriceData);
    document.getElementById('singleBrandSearchBtn').addEventListener('click', loadSingleBrandSearchData);
    document.getElementById('priceSummaryBtn').addEventListener('click', loadPriceSummaryData);
</script>

</body>
</html>